# 玩法概览

本文档描述 Chest Idle 的整体玩法框架，覆盖行动系统、技能体系、资源循环与战斗流程。所有内容均以“前端单机先行，后端可扩展”为设计前提。

## 1. 核心循环

1. 玩家在主界面浏览技能列表，挑选行动目标。
2. 将行动添加到队列或立即执行。自动行动完全无随机，实时结算产物、经验与宝箱能量。
3. 宝箱能量达到阈值后生成宝箱，玩家可在任意时刻手动开箱（唯一包含随机步骤）。
4. 通过产出的资源制作工具、装备、消耗品，或挑战战斗行动进一步解锁内容。

## 2. 行动系统

### 行动类型

- **生产行动**：采矿、伐木、采摘、锻造、木工、缝纫、烹饪、冲泡。
- **战斗行动**：挑战单个敌人或敌人小队的战斗模拟与执行。

### 行动属性

- `duration`：基础耗时，受技能等级和增益影响。
- `xp`：固定技能经验收益。
- `chestPoints`：固定宝箱能量增量。
- `ingredients`：可选消耗材料。生产行动中采矿/伐木/采摘无材料消耗，其余职业按照配方消耗材料。
- `products`：固定产物列表。

### 行动队列规则

- 同时仅能执行一个行动，队列可排后续行动。
- 行动加入队列时若存在材料需求，会即时计算可执行次数并将数量缩减为可行最小值。
- 行动完成一次即结算一次产出，无批量缓存。
- 队列首行动耗尽计划次数后自动移除，下一项顶替。

## 3. 技能与等级

| 类别 | 技能 | 说明 |
|---|---|---|
| 生产 | 采矿、伐木、采摘、锻造、木工、缝纫、烹饪、冲泡 | 控制对应行动的耗时与解锁权限。 |
| 战斗 | 智力、耐力、防御、近战、远程、魔法 | 仅用于战斗面板分类，提供属性来源。 |

- 每个生产技能拥有独立 XP & 等级。等级超过行动要求时，每超 1 级提供既定速度加成（详见前端文档）。
- 战斗技能表现为属性集合（攻速、伤害、防御等），用于战斗公式计算。

## 4. 资源与制作链

### 采集系

- **采矿**：产出各级矿石。
- **伐木**：产出各级木材。
- **采摘**：产出肉类、鱼类、蔬菜、水果、咖啡豆 / 纤维植物。奇数区域产咖啡豆，偶数区域产纤维植物，可选择单品或整区域采集（收益为五种单品之和，耗时为单品 ×4）。

### 制作系

- **锻造**：矿石 → 金属锭；制作近战装备与金属工具。
- **木工**：木材 → 木板；制作远程/魔法武器与副手。
- **缝纫**：纤维 → 布料，皮革加工；制作远程/魔法防具及额外槽位袋子。
- **烹饪**：肉类（慢速 HP 续航）、鱼类（瞬发 HP）、蔬菜（慢速 MP）、水果（瞬发 MP）。
- **冲泡**：咖啡（战斗增益）、茶（生产增益，原料来自战斗掉落）。

### 槽位系统

- 基础槽位：1 个咖啡槽、1 个茶槽、1 个食物槽。
- 袋子装备可增加槽位，但同类型增益不可同时准备多份（例如多个咖啡槽仍只能生效一种咖啡）。

## 5. 战斗系统

### 战斗流程

1. 玩家选择敌人或敌人小队。
2. 客户端立即运行一次确定性仿真：按技能、装备、消耗品计算胜负与耗时。
3. 仿真失败或超时（> 预设上限）则拒绝战斗；仿真成功后玩家方可选择正式开始。
4. 正式战斗前预留固定等待时间，随后按仿真结果播放战斗进程并结算。

### 战斗要素

- **攻击循环**：普通攻击 + 战技（含施法时间、冷却）。
- **命中规则**：无闪避/暴击，所有攻击必命中。
- **目标选择**：非群攻技能总是攻击对方前排单位。
- **属性**：护甲、抗性、攻击属性等全部参与公式，无随机。
- **消耗品**：食物用于恢复 HP/MP，咖啡/茶提供战斗或生产增益，由槽位配置控制。

### 未来多人同步

- 正式战斗需要服务器二次仿真验证，确保结果一致。
- 服务端存储战斗开始时间、耗时、消耗品使用量，并在冷却/等待期结束后下发最终结算。

## 6. 宝箱与随机

- 行动产出的宝箱能量存于对应 `Chest`，能量溢出自动转换为宝箱道具。
- 开箱是唯一包含随机的步骤，未来将由服务器执行随机抽样并返回掉落。
- 客户端需实时追踪宝箱能量进度，支持离线累积换算。

## 7. 离线与时间轴

- 行动的耗时与收益可通过整数除法快速计算，允许玩家长时间离线后一次性结算。
- 客户端维护本地时间线，未来上线后端时以服务器时间戳校准。

## 8. 多人扩展要点

- 服务器职责集中在：校准行动开始时间、处理开箱随机、验证战斗结果。
- 采用 HTTP 短连接，只有在玩家执行关键操作时才请求服务器。
- 数据模型需保持可序列化、可重放，以便快速重建玩家状态。

---

此玩法文档与其他前端文档互为补充，后续改动需同步更新对应章节。