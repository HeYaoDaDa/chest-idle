# 功能任务拆解

本文件将 Chest Idle 项目拆分为若干模块，并进一步列出细分任务。优先顺序建议按阶段推进，可根据资源灵活调整。

## 阶段 0：基础设施

1. **工具链配置**
   - 初始化 Vue 3 + TypeScript + Vite 项目结构。
   - 集成 ESLint、Prettier、Stylelint（可选）、Commit 规范。
   - 配置 Vitest 与测试覆盖率统计。
2. **国际化与样式基础**
   - 接入 Vue I18n，提供中英文文案框架。
   - 建立 Sass 变量体系（颜色、字体、间距、阴影）。
3. **数据加载框架**
   - 实现静态 JSON 加载器与校验脚本。
   - 搭建 `DataAssembler` 与基础模型类的单元测试。

## 阶段 1：核心系统

1. **技能与状态管理**
   - 构建 `skills` store，支持 XP、等级、速度加成计算。
   - 实现技能页面基础 UI，展示行动列表。
2. **行动队列引擎**
   - 开发行动模型、队列 store 与帧驱动循环。
   - 实现行动详情弹窗、次数输入（含无限符号）与队列操作。
   - 支持材料检查与自动缩减数量。
3. **离线结算**
   - 设计 `GameClock` 及 `fastForward` 接口。
   - 启动时根据上次时间戳批量结算行动，并生成通知。
4. **仓库与装备**
   - 建立仓库 store，支持物品堆叠、装备槽位、袋子槽。
   - 实现装备/卸下、槽位增益计算。
5. **宝箱系统**
   - 实现宝箱能量累积、生成宝箱道具。
   - 构建开箱弹窗（初期可采用客户端随机）。

## 阶段 2：战斗系统

1. **战斗数据模型**
   - 定义敌人、技能、属性、消耗品数据结构。
   - 编写战斗仿真模块：事件队列、伤害计算、消耗品触发。
2. **战斗 UI**
   - 敌人选择界面、仿真结果展示、失败原因反馈。
   - 战斗回放与进度条（基于仿真结果渲染）。
3. **资源联动**
   - 战斗掉落与茶叶产出，连接冲泡系统。
   - 战斗使用的咖啡/食物与仓库同步。

## 阶段 3：增益与消耗品

1. **咖啡/茶槽位逻辑**
   - 槽位配置界面，持续时间与自动补充算法。
   - 与行动/战斗速度、经验加成联动。
2. **食物系统**
   - 区分立即恢复与持续恢复，战斗中调用。
   - UI 中显示剩余触发次数与冷却。

## 阶段 4：体验优化

1. **通知与历史记录**
   - 实装通知中心，分类展示队列事件、开箱结果。
   - 提供离线报告页面，列出离线结算明细。
2. **引导与帮助**
   - 首次进入引导流程（分步提示行动、背包、战斗）。
   - 内嵌帮助文档或跳转链接。
3. **响应式与可访问性**
   - 完成移动端适配与键盘可访问性检查。
   - 提供主题切换与动画开关。

## 阶段 5：未来多人化准备

1. **持久化与同步接口**
   - IndexedDB 存档、版本迁移。
   - 设计与后端通信的数据契约（DTO）。
2. **服务端占位实现**
   - 建立 `ApiPort` 接口，模拟 HTTP 请求。
   - 通过配置切换真实/模拟后端。
3. **安全与校验**
   - 编写客户端数据校验器，检测异常状态。
   - 规划服务端二次仿真与开箱随机接口。

---

以上任务列表为迭代式开发提供指导。每次迭代完成后请更新状态、补充新需求，并在文档中记录关键决定或架构调整。